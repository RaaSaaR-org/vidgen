<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<style>
  * { margin: 0; padding: 0; box-sizing: border-box; }

  :root {
    --frame: {{frame}};
    --total-frames: {{total_frames}};
    --progress: calc(var(--frame) / var(--total-frames));
  }

  body {
    width: {{width}}px;
    height: {{height}}px;
    overflow: hidden;
    position: relative;
    background: {{effective_background}};
    color: {{theme_text}};
    font-family: '{{theme_font_heading}}', system-ui, -apple-system, sans-serif;
  }

  .scene-container {
    container-type: size;
    width: 100%;
    height: 100%;
    position: relative;
  }

  .lower-third {
    position: absolute;
    bottom: 15%;
    left: 0;
    display: flex;
    align-items: stretch;
    /* Slide in from left: 0% → 20% progress; slide out: 85% → 100% */
    transform: translateX(
      calc(
        -100% * (1 - clamp(0, calc(var(--progress) * 5), 1))
        + 100% * clamp(0, calc((var(--progress) - 0.85) * (1 / 0.15)), 1)
      )
    );
  }

  /* Position variant: center */
  .lower-third.center {
    left: 50%;
    transform: translateX(
      calc(
        -50%
        - 50% * (1 - clamp(0, calc(var(--progress) * 5), 1))
        + 50% * clamp(0, calc((var(--progress) - 0.85) * (1 / 0.15)), 1)
      )
    );
  }

  /* Position variant: right */
  .lower-third.right {
    left: auto;
    right: 0;
    transform: translateX(
      calc(
        100% * (1 - clamp(0, calc(var(--progress) * 5), 1))
        - 100% * clamp(0, calc((var(--progress) - 0.85) * (1 / 0.15)), 1)
      )
    );
  }

  .accent-bar {
    width: 6px;
    background: {{accent_color}};
    flex-shrink: 0;
    /* Grow height: 5% → 15% progress */
    transform: scaleY(clamp(0, calc((var(--progress) - 0.05) * 10), 1));
    transform-origin: bottom;
  }

  .text-block {
    background: rgba(0, 0, 0, 0.7);
    padding: 1.5rem 3rem 1.5rem 2rem;
  }

  .name {
    font-size: clamp(1.5rem, 2.5vw, 3rem);
    font-weight: 700;
    line-height: 1.2;
    /* Fade in: 10% → 25% progress */
    opacity: clamp(0, calc((var(--progress) - 0.1) * (1 / 0.15)), 1);
    transform: translateX(calc((1 - clamp(0, calc((var(--progress) - 0.1) * (1 / 0.15)), 1)) * 30px));
  }

  .title {
    font-size: clamp(1rem, 1.6vw, 1.8rem);
    font-weight: 400;
    font-family: '{{theme_font_body}}', system-ui, -apple-system, sans-serif;
    margin-top: 0.3rem;
    /* Fade in: 20% → 35% progress */
    opacity: clamp(0, calc((var(--progress) - 0.2) * (1 / 0.15)), 0.8);
    transform: translateX(calc((1 - clamp(0, calc((var(--progress) - 0.2) * (1 / 0.15)), 1)) * 20px));
  }

  @container (aspect-ratio < 1) {
    .lower-third {
      bottom: 10%;
      left: 0;
      right: 0;
    }
    .text-block {
      flex: 1;
      padding: 1.5rem 2rem;
    }
    .name {
      font-size: clamp(1.5rem, 5vw, 3rem);
    }
    .title {
      font-size: clamp(1rem, 3vw, 2rem);
    }
  }
</style>
</head>
<body>
  <div class="scene-container">
    <div class="lower-third {{position}}">
      <div class="accent-bar"></div>
      <div class="text-block">
        <div class="name">{{name}}</div>
        {{#if title}}
        <div class="title">{{title}}</div>
        {{/if}}
      </div>
    </div>
  </div>
</body>
</html>
